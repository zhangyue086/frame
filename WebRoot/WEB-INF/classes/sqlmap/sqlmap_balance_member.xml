<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="balanceMemberMapper">
	<resultMap type="com.zline.zlogistics.biz.dal.entity.BalanceMember"
		id="balanceMemberResult">
		<id property="balanceId" column="balance_id" />

		<result property="dmWorkNumber" column="dm_work_number" />
		<result property="logisticsOrderId" column="logistics_order_id" />
		<result property="balancedAccount" column="balanced_account" />
		<result property="balancedStationId" column="balanced_station_id" />
		<result property="stationBalanceStatus" column="station_balance_status" />
		<result property="dateVersion" column="data_version" />
		<result property="isDeleted" column="is_deleted" />

		<result property="createId" column="create_id" />
		<result property="createTime" column="create_time" />
		<result property="lastUpdateTime" column="last_update_time" />
		<result property="lastUpdateId" column="last_update_id" />

	</resultMap>

	<insert id="insertOne" parameterType="com.zline.zlogistics.biz.dal.entity.BalanceMember">
		INSERT INTO 
			`zlogistics`.`logistics_order_balance_member`
			(	
				is_deleted,create_time,create_id,last_update_id
				<if test="dmWorkNumber != null">
					,dm_work_number
				</if>
				<if test="logisticsOrderId != null">
					,logistics_order_id
				</if>
				<if test="balancedAccount != null">
					,balanced_account
				</if>
				<if test="balancedStationId != null">
					,balanced_station_id
				</if>
			)
			VALUES
			(0,now(),#{createId},#{lastUpdateId}
				<if test="dmWorkNumber != null">
					,#{dmWorkNumber}
				</if>
				<if test="logisticsOrderId != null">
					,#{logisticsOrderId}
				</if>
				<if test="balancedAccount != null">
					,#{balancedAccount}
				</if>
				<if test="balancedStationId != null">
					,#{balancedStationId}
				</if>
			)
	
	</insert>
	
	<update id="updateByMemberDto" parameterType="com.zline.zlogistics.biz.dal.dto.BalanceMemberDto">
		update `zlogistics`.`logistics_order_balance_member` 
		set data_version = data_version + 1 ,last_update_time = now()
		<if test="stationBalanceStatus != null ">
		,station_balance_status = #{stationBalanceStatus}
		</if>
		where balance_id = #{balanceId}
	</update>
	<select id="queryForLine0Total" resultMap="balanceMemberResult" parameterType="com.zline.zlogistics.biz.dal.dto.BalanceMemberDto">
		SELECT 
			balance_id,
			balanced_account,
			balanced_station_id,
			is_deleted
		 FROM zlogistics.logistics_order_balance_member
		 WHERE balanced_station_id =#{balancedStationId}  
		<![CDATA[
		 AND create_time > concat(#{searchDate},' 00:00:00') and create_time < concat(#{searchDate},' 23:59:59')
		]]>
		 AND is_deleted = 0
	</select>
</mapper>